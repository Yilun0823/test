<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Page Title</title>
</head>
<body>

<!-- Your HTML content goes here -->

<script>
  // import _ from 'lodash'
  const loginPromise = (async () => {
    await liff.init({ liffId: '#{liffId}' })
    if (new URL(location).searchParams.get('liff.state') !== null) {
      // 由於 SDK 尚未處理 liff.state 的跳轉
      // 所以透過一個不會結束的 Promise 避免程式繼續執行下去
      await new Promise(resolve => {})
    }
    if (!liff.isLoggedIn()) {
      liff.login({ redirectUri: location.href })
      // 由於用戶尚未登入 LINE
      // 所以透過一個不會結束的 Promise 避免程式繼續執行下去
      await new Promise(resolve => {})
    }
    // ... 其他初始化程式碼 ...
  })()

  async function isFriend () {
    return _.get(await liff.getFriendship(), 'friendFlag', false)
  }

  async function sleep (t) {
    await new Promise(resolve => { setTimeout(resolve, t) })
  }

  async function waitAddFriend () {
    await loginPromise // 確保 LIFF 頁面初始化結束
    if (await isFriend()) return // 如果用戶已經是好友就直接結束

    // 檢測是否已加入官方號
    const joinedOfficialAccount = /* Add your logic to check if joined official account */;
    if (joinedOfficialAccount) {
      window.location.href = 'https://forms.gle/3RCbSC4r7LdG4Skf6'; // 跳轉到指定 URL
      return;
    }

    // 未加入官方號，顯示加入好友的頁面
    showPage('follow');

    while (true) {
      // 避免過於頻繁執行 isFriend() 所以設定 0.5 秒的間隔
      await sleep(500);
      // 如果用戶已經是好友就結束
      if (await isFriend()) return;
    }
  }

  async function init () {
    await waitAddFriend(); // 等待用戶加入好友

    // 如果這裡需要顯示其他主頁面的初始化邏輯，可以在這裡添加
    // showPage('main');
  }

  // Add your logic to check if joined official account
  // const joinedOfficialAccount = /* Your logic here */;

  // Call init function
  init();
</script>

</body>
</html>
